<golden-page-header headerText="Ordine in corso"></golden-page-header>

<div class="md:m-10 flex justify-center">
  <div class="md:mx-10 w-10/12 lg:w-full">
    <div class="flex flex-col-reverse md:flex-row md:justify-between">
      <div class="flex justify-center md:w-8/12 md:border-r-2 md:pr-4">
        <div class="space-y-4 w-10/12 md:w-full">
          <button
            class="rounded-lg shadow my-2 py-2 px-4 bg-legio-green-400 text-white hover:bg-legio-green-500 text-sm flex w-full justify-center"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 mr-1"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z"
                clip-rule="evenodd"
              />
            </svg>
            Aggiungi un oggetto all'ordine
          </button>
          <div class="md:overflow-y-scroll space-y-4 max-h-screen">
            <div
              class="shadow sm:w-8/12 md:w-full sm:border-b"
              *ngFor="let item of items"
            >
              <app-order-item-card [item]="item"></app-order-item-card>
            </div>
          </div>
        </div>
      </div>

      <div class="md:w-4/12 mx-4 my-10 md:my-0">
        <div class="rounded-lg shadow-lg bg-white w-full p-2 px-4">
          <h1
            class="text-lg font-medium uppercase text-gray-800 text-right mt-2"
          >
            ORDINE DI GRUPPO #{{ currentOrder.orderPublicId }}
          </h1>
          <div class="text-gray-500 text-right text-sm">
            Scade il {{ currentOrder.dueDate | date: "dd/MM/yyyy" }}
          </div>
          <div class="text-sm text-gray-400 uppercase text-right">
            <span> {{ getTotalQuantity(items) }}</span>
            <span> Oggetti</span>
          </div>

          <div class="text-gray-600 tracking-wide py-2 text-sm space-y-2 my-2">
            <ng-container
              [ngTemplateOutlet]="summaryRow"
              [ngTemplateOutletContext]="{
                rowLabel: 'Non confermati',
                statusCheck: 'pending-confirmation'
              }"
            ></ng-container>
            <ng-container
              [ngTemplateOutlet]="summaryRow"
              [ngTemplateOutletContext]="{
                rowLabel: 'Pagato',
                statusCheck: 'confirmed'
              }"
            ></ng-container>
            <ng-container
              [ngTemplateOutlet]="summaryRow"
              [ngTemplateOutletContext]="{
                rowLabel: 'Non Pagato',
                statusCheck: 'pending-payment'
              }"
            ></ng-container>

            <div class="border-t pt-2 flex justify-between">
              <span>Totale</span>
              <span>{{
                getPriceToPay(items, "pending-payment") +
                  getPriceToPay(items, "confirmed") | currency: "€"
              }}</span>
            </div>

            <div class="">
              <button
                class="rounded-lg w-full font-medium px-2 hover:bg-legio-gold-600 my-2 shadow-lg py-2"
                [ngClass]="
                  isPaymentPending(items)
                    ? 'pointer-events-none bg-gray-200  text-gray-600'
                    : 'bg-legio-gold text-white'
                "
              >
                <span *ngIf="isPaymentPending(items)"
                  >Paga gli oggetti in attesa per confermarne altri</span
                >
                <span *ngIf="!isPaymentPending(items)">
                  Conferma ({{
                    getPriceToPay(items, "pending-confirmation")
                      | currency: "€"
                  }})</span
                >
              </button>
            </div>
          </div>
        </div>

        <div class="mt-5 md:mx-10">
          <div class="flex justify-center">
            <div>
              <h1
                class="text-xl font-semibold tracking-wider uppercase text-legio-green"
              >
                Negozi disponibili
              </h1>
              <div
                class="bg-white rounded-lg border border-gray-200 w-96 text-gray-900"
              >
                <a
                  href="https://www.taiwangun.com/"
                  target="_blank"
                  *ngIf="currentOrder.shops.includes('taiwangun')"
                >
                  <button
                    class="text-legio-green text-left px-6 py-2 border-b border-gray-200 w-full hover:bg-gray-100 hover:text-gray-500 focus:outline-none focus:ring-0 transition duration-500 cursor-pointer"
                  >
                    Taiwan Gun
                  </button>
                </a>
                <a
                  href="https://www.ilsemaforo.com/"
                  target="_blank"
                  *ngIf="currentOrder.shops.includes('ilsemaforo')"
                >
                  <button
                    class="text-legio-green text-left px-6 py-2 border-b border-gray-200 w-full hover:bg-gray-100 hover:text-gray-500 focus:outline-none focus:ring-0 transition duration-500 cursor-pointer"
                  >
                    IlSemaforo
                  </button>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <ng-template
    #summaryRow
    let-statusCheck="statusCheck"
    let-rowLabel="rowLabel"
  >
    <div class="flex justify-between">
      <span> {{ rowLabel }}</span>
      <span>{{ getPriceToPay(items, statusCheck) | currency: "€" }}</span>
    </div>
  </ng-template>
</div>
